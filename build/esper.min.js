!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.esper=t()}}(function(){var t;return function e(t,r,i){function n(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return n(r?r:e)},c,c.exports,e,t,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(e,r,i){(function(){var e,r,n,o,s,a,u,f,c,h,l,p,d,v,m=[].slice;s="3.0.0",r="pending",o="resolved",n="rejected",c=function(t,e){return null!=t?t.hasOwnProperty(e):void 0},l=function(t){return c(t,"length")&&c(t,"callee")},p=function(t){return c(t,"promise")&&"function"==typeof(null!=t?t.promise:void 0)},f=function(t){return l(t)?f(Array.prototype.slice.call(t)):Array.isArray(t)?t.reduce(function(t,e){return Array.isArray(e)?t.concat(f(e)):(t.push(e),t)},[]):[t]},a=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},d=function(t,e){return function(){var r;return r=[t].concat(Array.prototype.slice.call(arguments,0)),e.apply(this,r)}},u=function(t,e,r){var i,n,o,s,a;for(s=f(t),a=[],n=0,o=s.length;o>n;n++)i=s[n],a.push(i.call.apply(i,[r].concat(m.call(e))));return a},e=function(){var t,i,s,a,c,h,l;return l=r,a=[],c=[],h=[],s={resolved:{},rejected:{},pending:{}},this.promise=function(t){var i,d;return t=t||{},t.state=function(){return l},d=function(e,i,n){return function(){return l===r&&i.push.apply(i,f(arguments)),e()&&u(arguments,s[n]),t}},t.done=d(function(){return l===o},a,o),t.fail=d(function(){return l===n},c,n),t.progress=d(function(){return l!==r},h,r),t.always=function(){var e;return(e=t.done.apply(t,arguments)).fail.apply(e,arguments)},i=function(r,i,n){var o,s;return s=new e,o=function(e,r,i){return i?t[e](function(){var t,e;return t=1<=arguments.length?m.call(arguments,0):[],e=i.apply(null,t),p(e)?e.done(s.resolve).fail(s.reject).progress(s.notify):s[r](e)}):t[e](s[r])},o("done","resolve",r),o("fail","reject",i),o("progress","notify",n),s},t.pipe=i,t.then=i,null==t.promise&&(t.promise=function(){return t}),t},this.promise(this),t=this,i=function(e,i,n){return function(){return l===r?(l=e,s[e]=arguments,u(i,s[e],n),t):this}},this.resolve=i(o,a),this.reject=i(n,c),this.notify=i(r,h),this.resolveWith=function(t,e){return i(o,a,t).apply(null,e)},this.rejectWith=function(t,e){return i(n,c,t).apply(null,e)},this.notifyWith=function(t,e){return i(r,h,t).apply(null,e)},this},v=function(){var t,r,i,n,o,s,u;if(r=f(arguments),1===r.length)return p(r[0])?r[0]:(new e).resolve(r[0]).promise();if(o=new e,!r.length)return o.resolve().promise();for(n=[],i=a(r.length,function(){return o.resolve.apply(o,n)}),r.forEach(function(t,e){return p(t)?t.done(function(){var t;return t=1<=arguments.length?m.call(arguments,0):[],n[e]=t.length>1?t:t[0],i()}):(n[e]=t,i())}),s=0,u=r.length;u>s;s++)t=r[s],p(t)&&t.fail(o.reject);return o.promise()},h=function(t){return t.Deferred=function(){return new e},t.ajax=d(t.ajax,function(t,r){var i,n,o,s;return null==r&&(r={}),n=new e,i=function(t,e){return d(t,function(){var t,r;return r=arguments[0],t=2<=arguments.length?m.call(arguments,1):[],r&&r.apply(null,t),e.apply(null,t)})},r.success=i(r.success,n.resolve),r.error=i(r.error,n.reject),s=t(r),o=n.promise(),o.abort=function(){return s.abort()},o}),t.when=v},"undefined"!=typeof i?(i.Deferred=function(){return new e},i.when=v,i.installInto=h):"function"==typeof t&&t.amd?t(function(){return"undefined"!=typeof Zepto?h(Zepto):(e.when=v,e.installInto=h,e)}):"undefined"!=typeof Zepto?h(Zepto):(this.Deferred=function(){return new e},this.Deferred.when=v,this.Deferred.installInto=h)}).call(this)},{}],2:[function(t,e,r){!function(){"use strict";function r(t,e){e=e||{},this.gl=i.get(),this.buffer=0,t&&(t instanceof WebGLBuffer?(this.buffer=t,this.type=e.type||"UNSIGNED_SHORT",this.count=void 0!==e.count?e.count:0):this.bufferData(t)),this.offset=void 0!==e.offset?e.offset:0,this.mode=void 0!==e.mode?e.mode:"TRIANGLES"}var i=t("./WebGLContext"),n=null;r.prototype.bufferData=function(t){var e=this.gl,r=i.checkExtension("OES_element_index_uint");if(r?t instanceof Array&&(t=new Uint32Array(t)):t instanceof Array?t=new Uint16Array(t):t instanceof Uint32Array&&(console.warn("Cannot create IndexBuffer of format gl.UNSIGNED_INT as OES_element_index_uint is not supported, defaulting to gl.UNSIGNED_SHORT."),t=new Uint16Array(t)),t instanceof Uint16Array)this.type="UNSIGNED_SHORT";else{if(!(t instanceof Uint32Array))return void console.error("IndexBuffer requires an Array or ArrayBuffer argument, command ignored.");this.type="UNSIGNED_INT"}return this.buffer=e.createBuffer(),this.count=t.length,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this},r.prototype.bind=function(){if(n!==this){var t=this.gl;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),n=this,this}},r.prototype.unbind=function(){if(null!==n){var t=this.gl;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),n=null,this}},r.prototype.draw=function(t){if(t=t||{},null===n)return void console.warn("No IndexBuffer is bound, command ignored.");var e=this.gl,r=e[t.mode||this.mode||"TRIANGLES"],i=void 0!==t.offset?t.offset:this.offset,o=void 0!==t.count?t.count:this.count;return e.drawElements(r,o,e[this.type],i),this},e.exports=r}()},{"./WebGLContext":12}],3:[function(t,e,r){!function(){"use strict";function r(t){if(u!==t){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),u=t}}function i(t){if(null!==u){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),u=null}}function n(){var t=this.gl=o.get();return this.framebuffer=t.createFramebuffer(),this.textures={},this}var o=t("./WebGLContext"),s=t("../util/Stack"),a=new s,u=null;n.prototype.push=function(){return a.push(this),r(this),this},n.prototype.pop=function(){var t;return a.pop(),t=a.top(),t?r(t):i(this),this},n.prototype.setColorTarget=function(t,e,r){var i=this.gl;return"string"==typeof e&&(r=e,e=void 0),e=void 0!==e?e:0,this.textures["color"+e]=t,this.push(),i.framebufferTexture2D(i.FRAMEBUFFER,i["COLOR_ATTACHMENT"+e],i[r||"TEXTURE_2D"],t.texture,0),this.pop(),this},n.prototype.setDepthTarget=function(t){var e=this.gl;return this.textures.depth=t,this.push(),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,t.texture,0),this.pop(),this},n.prototype.clearColor=function(t,e,r,i){var n=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,r=void 0!==r?r:0,i=void 0!==i?i:0,this.push(),n.clearColor(t,e,r,i),n.clear(n.COLOR_BUFFER_BIT),this.pop(),this},n.prototype.clearDepth=function(t,e,r,i){var n=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,r=void 0!==r?r:0,i=void 0!==i?i:0,this.push(),n.clearColor(t,e,r,i),n.clear(n.DEPTH_BUFFER_BIT),this.pop(),this},n.prototype.clearStencil=function(t,e,r,i){var n=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,r=void 0!==r?r:0,i=void 0!==i?i:0,this.push(),n.clearColor(t,e,r,i),n.clear(n.STENCIL_BUFFER_BIT),this.pop(),this},n.prototype.clear=function(t,e,r,i){var n=this.gl;return t=void 0!==t?t:0,e=void 0!==e?e:0,r=void 0!==r?r:0,i=void 0!==i?i:0,this.push(),n.clearColor(t,e,r,i),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this.pop(),this},n.prototype.resize=function(t,e){var r;if(!t||!e)return console.warn("Width or height arguments missing, command ignored."),this;for(r in this.textures)this.textures.hasOwnProperty(r)&&this.textures[r].resize(t,e);return this},e.exports=n}()},{"../util/Stack":14,"./WebGLContext":12}],4:[function(t,e,r){!function(){"use strict";function r(t,e){if(t=t||{},e=e||{},t.vertexBuffer||t.vertexBuffers)this.vertexBuffers=t.vertexBuffers||[t.vertexBuffer];else{var r=new i(t.vertices);this.vertexBuffers=[new n(r)]}return t.indexBuffer?this.indexBuffer=t.indexBuffer:t.indices&&(this.indexBuffer=new o(t.indices)),this.options={mode:e.mode,offset:e.offset,count:e.count},this}var i=t("../core/VertexPackage"),n=t("../core/VertexBuffer"),o=t("../core/IndexBuffer");r.prototype.draw=function(t){var e=t||{};return e.mode=e.mode||this.options.mode,e.offset=void 0!==e.offset?e.offset:this.options.offset,e.count=void 0!==e.count?e.count:this.options.count,this.indexBuffer?(this.vertexBuffers.forEach(function(t){t.bind()}),this.indexBuffer.bind(),this.indexBuffer.draw(e)):this.vertexBuffers.forEach(function(t){t.bind(),t.draw(e)}),this},e.exports=r}()},{"../core/IndexBuffer":2,"../core/VertexBuffer":9,"../core/VertexPackage":10}],5:[function(t,e,r){!function(){"use strict";function r(t,e){var r,i,n=d.parseDeclarations([t,e],["uniform","attribute"]),o={},s={},a=0;for(i=0;i<n.length;i++)r=n[i],"attribute"===r.qualifier?o[r.name]={type:r.type,index:a++}:"uniform"===r.qualifier&&(s[r.name]={type:r.type,func:E[r.type+(r.count>1?"[]":"")]});return{attributes:o,uniforms:s}}function i(t,e,r){var i=t.createShader(t[r]);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(i)),null)}function n(t){var e,r=t.gl,i=t.attributes;for(e in i)i.hasOwnProperty(e)&&r.bindAttribLocation(t.program,i[e].index,e)}function o(t){var e,r,i=t.gl,n=t.uniforms;for(r in n)n.hasOwnProperty(r)&&(e=n[r],e.location=i.getUniformLocation(t.program,r))}function s(t){return function(e){m.load(t,{responseType:"text",success:e,error:function(t){console.error(t),e(null)}})}}function a(t){return function(e){e(t)}}function u(t){return function(e){var r=[];t=t||[],t=t instanceof Array?t:[t],t.forEach(function(t){d.isGLSL(t)?r.push(a(t)):r.push(s(t))}),v.async(r,function(t){e(t)})}}function f(t){x!==t&&(t.gl.useProgram(t.program),x=t)}function c(t){null!==x&&(t.gl.useProgram(null),x=null)}function h(t){return t.program=null,t.attributes=null,t.uniforms=null,t}function l(t,e){var r=this;t=t||{},this.program=0,this.gl=p.get(),this.version=t.version||"1.00",t.vert||console.error("Vertex shader argument has not been provided, shader initialization aborted."),t.frag||console.error("Fragment shader argument has not been provided, shader initialization aborted."),v.async({common:u(t.common),vert:u(t.vert),frag:u(t.frag)},function(t){r.create(t),e&&e(r)})}var p=t("./WebGLContext"),d=t("./ShaderParser"),v=t("../util/Util"),m=t("../util/XHRLoader"),g=t("../util/Stack"),E={bool:"uniform1i","bool[]":"uniform1iv","float":"uniform1f","float[]":"uniform1fv","int":"uniform1i","int[]":"uniform1iv",uint:"uniform1i","uint[]":"uniform1iv",vec2:"uniform2fv","vec2[]":"uniform2fv",ivec2:"uniform2iv","ivec2[]":"uniform2iv",vec3:"uniform3fv","vec3[]":"uniform3fv",ivec3:"uniform3iv","ivec3[]":"uniform3iv",vec4:"uniform4fv","vec4[]":"uniform4fv",ivec4:"uniform4iv","ivec4[]":"uniform4iv",mat2:"uniformMatrix2fv","mat2[]":"uniformMatrix2fv",mat3:"uniformMatrix3fv","mat3[]":"uniformMatrix3fv",mat4:"uniformMatrix4fv","mat4[]":"uniformMatrix4fv",sampler2D:"uniform1i",samplerCube:"uniform1i"},y=new g,x=null;l.prototype.create=function(t){var e,s,a,u=this.gl,f=t.common.join(""),c=t.vert.join(""),l=t.frag.join("");return e=i(u,f+c,"VERTEX_SHADER"),s=i(u,f+l,"FRAGMENT_SHADER"),e&&s?(a=r(c,l),this.attributes=a.attributes,this.uniforms=a.uniforms,this.program=u.createProgram(),u.attachShader(this.program,e),u.attachShader(this.program,s),n(this),u.linkProgram(this.program),u.getProgramParameter(this.program,u.LINK_STATUS)?(o(this),this):(console.error("An error occured linking the shader: "+u.getProgramInfoLog(this.program)),console.error("Aborting instantiation of shader due to linking errors."),h(this))):(console.error("Aborting instantiation of shader due to compilation errors."),h(this))},l.prototype.push=function(){return y.push(this),f(this),this},l.prototype.pop=function(){var t;return y.pop(),t=y.top(),t?f(t):c(this),this},l.prototype.setUniform=function(t,e){if(!this.program)return void(this.hasLoggedError||(console.warn("Attempting to use an incomplete shader, command ignored."),this.hasLoggedError=!0));var r,i,n,o,s=this.uniforms[t];if(!s)return void console.warn('No uniform found under name "'+t+'", command ignored.');if(void 0===e)return void console.warn('Argument passed for uniform "'+t+'" is undefined, command ignored.');switch(r=s.func,i=s.type,n=s.location,o=e.toArray?e.toArray():e,o=o instanceof Array?new Float32Array(o):o,o="boolean"==typeof o?o?1:0:o,i){case"mat2":case"mat3":case"mat4":this.gl[r](n,!1,o);break;default:this.gl[r](n,o)}return this},e.exports=l}()},{"../util/Stack":14,"../util/Util":15,"../util/XHRLoader":16,"./ShaderParser":6,"./WebGLContext":12}],6:[function(t,e,r){!function(){"use strict";function t(t){return t.replace(f,"")}function r(t){return t.replace(c," ").replace(h," ").replace(l,"$2$4$6")}function i(t,e,r,i){var n=i.match(p),o=n[1],s=void 0===n[2]?1:parseInt(n[2],10);return{qualifier:t,precision:e,type:r,name:o,count:s}}function n(t,e){var r,n=t.split(",").map(function(t){return t.trim()}),o=n.shift().split(" "),s=o.shift(),f=o.shift();a[f]?r=o.shift():(r=f,f=e[u[r]]);var c=o.concat(n),h=[];return c.forEach(function(t){h.push(i(s,f,r,t))}),h}function o(e,i){var o=t(e),s=r(o),a=s.split(";"),u=i.join("|"),f=new RegExp(".*\\b("+u+")\\b.*"),c={},h=[];return a.forEach(function(t){var e=t.match(d);if(e)return void(c[e[3]]=e[2]);var r=t.match(f);r&&(h=h.concat(n(r[0],c)))}),h}function s(t){var e={};return t.filter(function(t){return e[t.name]?!1:(e[t.name]=!0,!0)})}var a={highp:!0,mediump:!0,lowp:!0},u={"float":"float",vec2:"float",vec3:"float",vec4:"float",ivec2:"int",ivec3:"int",ivec4:"int","int":"int",uint:"int",sampler2D:"sampler2D",samplerCube:"samplerCube"},f=/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,c=/(\r\n|\n|\r)/gm,h=/\s{2,}/g,l=/(\s*)(\[)(\s*)(\d+)(\s*)(\])(\s*)/g,p=/([a-zA-Z_][a-zA-Z0-9_]*)(?:\[(\d+)\])?/,d=/\b(precision)\s+(\w+)\s+(\w+)/,v=/void\s+main\s*\(\s*\)\s*/gim;e.exports={parseDeclarations:function(t,e){if(!e||0===e.length||!t||0===t.length)return[];t=t instanceof Array?t:[t],e=e instanceof Array?e:[e];var r=[];return t.forEach(function(t){r=r.concat(o(t,e))}),s(r)},isGLSL:function(t){return v.test(t)}}}()},{}],7:[function(t,e,r){!function(){"use strict";function r(t){if(!a.isPowerOfTwo(t.width)||!a.isPowerOfTwo(t.height)){var e=document.createElement("canvas");e.width=a.nextHighestPowerOfTwo(t.width),e.height=a.nextHighestPowerOfTwo(t.height);var r=e.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t}function i(t,e){if(c!==t){var r=t.gl;e=r["TEXTURE"+e]||r.TEXTURE0,r.activeTexture(e),r.bindTexture(r.TEXTURE_2D,t.texture),c=t}}function n(t){if(null!==c){var e=t.gl;e.bindTexture(e.TEXTURE_2D,null),c=null}}function o(t,e){var r=this;if(t=t||{},this.gl=s.get(),this.texture=this.gl.createTexture(),this.wrap=t.wrap||"REPEAT",this.filter=t.filter||"LINEAR",this.invertY=void 0!==t.invertY?t.invertY:!0,t.image)this.bufferData(t.image),this.setParameters(this);else if(t.url){var i=new Image;i.onload=function(){r.bufferData(i),r.setParameters(r),e(r)},i.src=t.url}else{if("DEPTH_COMPONENT"===t.format){var n=s.checkExtension("WEBGL_depth_texture");if(!n)return void console.log("Cannot create Texture2D of format gl.DEPTH_COMPONENT as WEBGL_depth_texture is unsupported by this browser, command ignored");this.format=t.format,t.type&&"UNSIGNED_SHORT"!==t.type&&"UNSIGNED_INT"!==t.type?(console.log("Depth textures do not support type'"+t.type+"', defaulting to 'UNSIGNED_SHORT'."),this.type="UNSIGNED_SHORT"):this.type=t.type}else this.format=t.format||"RGBA",this.type=t.type||"UNSIGNED_BYTE";this.internalFormat=this.format,this.mipMap=void 0!==t.mipMap?t.mipMap:!1,this.bufferData(t.data||null,t.width,t.height),this.setParameters(this)}}var s=t("./WebGLContext"),a=t("../util/Util"),u=t("../util/Stack"),f={},c=null;o.prototype.push=function(t){return f[t]=f[t]||new u,f[t].push(this),i(this,t),this},o.prototype.pop=function(t){var e;return f[t]||console.warn("No texture was bound to texture unit '"+t+"', command ignored."),f[t].pop(),e=f[t].top(),e?i(e,t):n(this),this},o.prototype.bufferData=function(t,e,i){var n=this.gl;return this.push(),t instanceof HTMLImageElement?(this.width=t.width,this.height=t.height,t=r(t),this.image=t,this.mipMap=!0,n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,this.invertY),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)):(this.data=t,this.width=e||this.width,this.height=i||this.height,n.texImage2D(n.TEXTURE_2D,0,n[this.internalFormat],this.width,this.height,0,n[this.format],n[this.type],this.data)),this.mipMap&&n.generateMipmap(n.TEXTURE_2D),this.pop(),this},o.prototype.setParameters=function(t){var e=this.gl;if(this.push(),t.wrap&&(this.wrap=t.wrap,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[this.wrap.s||this.wrap]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[this.wrap.t||this.wrap])),t.filter){this.filter=t.filter;var r=this.filter.min||this.filter;this.mipMap&&(r+="_MIPMAP_LINEAR"),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[this.filter.mag||this.filter]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[r])}return this.pop(),this},o.prototype.resize=function(t,e){return this.image?void console.error("Cannot resize image based Texture2D"):t&&e?(this.bufferData(this.data,t,e),this):void console.warn("Width or height arguments missing, command ignored.")},e.exports=o}()},{"../util/Stack":14,"../util/Util":15,"./WebGLContext":12}],8:[function(t,e,r){!function(){"use strict";function r(t){if(!u.isPowerOfTwo(t.width)||!u.isPowerOfTwo(t.height)){var e=document.createElement("canvas");e.width=u.nextHighestPowerOfTwo(t.width),e.height=u.nextHighestPowerOfTwo(t.height);var r=e.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t}function i(t,e){if(p!==t){var r=t.gl;e=r["TEXTURE"+e]||r.TEXTURE0,r.activeTexture(e),r.bindTexture(r.TEXTURE_CUBE_MAP,t.texture),p=t}}function n(t){if(null!==p){var e=t.gl;e.bindTexture(e.TEXTURE_CUBE_MAP,null),p=null}}function o(t,e,r){return function(i){var n=new Image;n.onload=function(){t.bufferFaceData(r,n),i()},n.src=e}}function s(t,e){var r,i,n=this;if(this.gl=a.get(),this.texture=this.gl.createTexture(),this.wrap=t.wrap||"CLAMP_TO_EDGE",this.filter=t.filter||"LINEAR",this.invertY=void 0!==t.invertY?t.invertY:!1,t.images){for(r in t.images)t.images.hasOwnProperty(r)&&this.bufferFaceData(r,t.images[r]);this.setParameters(this)}else if(t.urls){i={};for(r in t.urls)t.urls.hasOwnProperty(r)&&(i[r]=o(this,t.urls[r],r));u.async(i,function(){n.setParameters(n),e(n)})}else this.format=t.format||"RGBA",this.internalFormat=this.format,this.type=t.type||"UNSIGNED_BYTE",this.mipMap=void 0!==t.mipMap?t.mipMap:!1,c.forEach(function(e){var r=(t.data?t.data[e]:t.data)||null;n.bufferFaceData(e,r,t.width,t.height)}),this.setParameters(this)}var a=t("./WebGLContext"),u=t("../util/Util"),f=t("../util/Stack"),c=["-x","+x","-y","+y","-z","+z"],h={"+z":"TEXTURE_CUBE_MAP_POSITIVE_Z","-z":"TEXTURE_CUBE_MAP_NEGATIVE_Z","+x":"TEXTURE_CUBE_MAP_POSITIVE_X","-x":"TEXTURE_CUBE_MAP_NEGATIVE_X","+y":"TEXTURE_CUBE_MAP_POSITIVE_Y","-y":"TEXTURE_CUBE_MAP_NEGATIVE_Y"},l={},p=null;s.prototype.push=function(t){return l[t]=l[t]||new f,l[t].push(this),i(this,t),this},s.prototype.pop=function(t){var e;return l[t]||console.log("No texture was bound to texture unit '"+t+"', command ignored."),l[t].pop(),e=l[t].top(),e?i(e,t):n(this),this},s.prototype.bufferFaceData=function(t,e,i,n){var o=this.gl,s=o[h[t]];return s||console.log("Invalid face enumeration '"+t+"' provided, command ignored."),this.push(),e instanceof HTMLImageElement?(this.images=this.images||{},this.images[t]=r(e),this.filter="LINEAR",this.mipMap=!0,o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,this.invertY),o.texImage2D(s,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,this.images[t])):(this.data=this.data||{},this.data[t]=e,this.width=i||this.width,this.height=n||this.height,o.texImage2D(s,0,o[this.internalFormat],this.width,this.height,0,o[this.format],o[this.type],e)),this.bufferedFaces=this.bufferedFaces||{},this.bufferedFaces[t]=!0,this.mipMap&&this.bufferedFaces["-x"]&&this.bufferedFaces["+x"]&&this.bufferedFaces["-y"]&&this.bufferedFaces["+y"]&&this.bufferedFaces["-z"]&&this.bufferedFaces["+z"]&&o.generateMipmap(o.TEXTURE_CUBE_MAP),this.pop(),this},s.prototype.setParameters=function(t){var e=this.gl;if(this.push(),t.wrap&&(this.wrap=t.wrap,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e[this.wrap.s||this.wrap]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e[this.wrap.t||this.wrap])),t.filter){this.filter=t.filter;var r=this.filter.min||this.filter;this.minMap&&(r+="_MIPMAP_LINEAR"),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e[this.filter.mag||this.filter]),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e[r])}return this.pop(),this},e.exports=s}()},{"../util/Stack":14,"../util/Util":15,"./WebGLContext":12}],9:[function(t,e,r){!function(){"use strict";function r(t){var e=4,r=0,i=0;return Object.keys(t).forEach(function(n){var o=t[n],s=o.offset;s>r&&(r=s,i=s+o.size*e)}),i}function i(t){if(!t||0===Object.keys(t).length)return console.warning("VertexBuffer requires attribute pointers to be specified upon instantiation, this buffer will not draw correctly."),{};var e={};return Object.keys(t).forEach(function(r){var i=parseInt(r,10);if(isNaN(i))return void console.warn("Attribute index '"+r+"' does not represent an integer, discarding attribute pointer.");var n=t[r],o=n.size,s=n.type,a=n.offset;(!o||1>o||o>4)&&(console.warn("Attribute pointer 'size' parameter is invalid, defaulting to 4."),o=4),s&&"FLOAT"===s||(console.warn("Attribute pointer 'type' parameter is invalid, defaulting to 'FLOAT'."),s="FLOAT"),e[i]={size:o,type:s,offset:void 0!==a?a:0}}),e}function n(t,e,n){n=n||{},this.buffer=0,this.gl=o.get(),t&&(t instanceof s?(this.bufferData(t.buffer()),n=e||{},e=t.attributePointers()):t instanceof WebGLBuffer?(this.buffer=t,this.count=void 0!==n.count?n.count:0):this.bufferData(t)),this.pointers=i(e),this.stride=r(this.pointers),this.offset=void 0!==n.offset?n.offset:0,this.mode=void 0!==n.mode?n.mode:"TRIANGLES"}var o=t("./WebGLContext"),s=t("./VertexPackage"),a=t("../util/Util"),u=null,f=null;n.prototype.bufferData=function(t){var e=this.gl;if(t instanceof Array)t=new Float32Array(t);else if(!a.isTypedArray(t)&&"number"!=typeof t)return void console.error("VertexBuffer requires an Array or ArrayBuffer, or a size argument, command ignored.");this.buffer||(this.buffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)},n.prototype.bufferSubData=function(t,e){var r=this.gl;if(!this.buffer)return void console.error("VertexBuffer has not been initially buffered, command ignored.");if(t instanceof Array)t=new Float32Array(t);else if(!a.isTypedArray(t))return void console.error("VertexBuffer requires an Array or ArrayBuffer argument, command ignored.");e=void 0!==e?e:0,r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferSubData(r.ARRAY_BUFFER,e,t)},n.prototype.bind=function(){if(u!==this){var t,e,r=this.gl,i=this.pointers,n=f||{};u=this,f={},r.bindBuffer(r.ARRAY_BUFFER,this.buffer);for(e in i)i.hasOwnProperty(e)&&(t=this.pointers[e],r.vertexAttribPointer(e,t.size,r[t.type],!1,this.stride,t.offset),r.enableVertexAttribArray(e),f[e]=!0,delete n[e]);for(e in n)n.hasOwnProperty(e)&&r.disableVertexAttribArray(e)}},n.prototype.draw=function(t){if(t=t||{},null===u)return void console.warn("No VertexBuffer is bound, command ignored.");var e=this.gl,r=e[t.mode||this.mode||"TRIANGLES"],i=void 0!==t.offset?t.offset:this.offset,n=void 0!==t.count?t.count:this.count;e.drawArrays(r,i,n)},n.prototype.unbind=function(){if(null!==u){var t,e=this.gl,r=this.pointers;for(t in r)r.hasOwnProperty(t)&&e.disableVertexAttribArray(t);e.bindBuffer(e.ARRAY_BUFFER,null),u=null,f={}}},e.exports=n}()},{"../util/Util":15,"./VertexPackage":10,"./WebGLContext":12}],10:[function(t,e,r){!function(){"use strict";function t(t){var e=[];return Object.keys(t).forEach(function(r){var i=parseInt(r,10);if(isNaN(i))return void console.warn("Attribute index '"+r+"' does not represent an integer, discarding attribute pointer.");var n=t[r];n&&n instanceof Array&&n.length>0?e.push({index:i,data:n}):console.warn("Error parsing attribute of index '"+r+"', attribute discarded.")}),e.sort(function(t,e){return t.index-e.index}),e}function r(t){return void 0!==t.x?void 0!==t.y?void 0!==t.z?void 0!==t.w?4:3:2:1:t instanceof Array?t.length:1}function i(t,e){var i=Number.MAX_VALUE,n=0;t.pointers={},e.forEach(function(e){var a=r(e.data[0]);i=Math.min(i,e.data.length),t.pointers[e.index]={type:o,size:a,offset:n*s},n+=a}),t.stride=n*s,t.length=i}function n(t){return void 0!==t?this.set(t):(this.data=new Float32Array(0),void(this.pointers={}))}var o="FLOAT",s=4;n.prototype.set=function(e){var r=this,n=t(e);return i(this,n),this.data=new Float32Array(this.length*(this.stride/s)),n.forEach(function(t){var e,i,n,o=r.pointers[t.index],a=o.offset/s,u=r.stride/s;for(i=0;i<r.length;i++)switch(e=t.data[i],n=a+u*i,o.size){case 2:r.data[n]=void 0!==e.x?e.x:e[0],r.data[n+1]=void 0!==e.y?e.y:e[1];break;case 3:r.data[n]=void 0!==e.x?e.x:e[0],r.data[n+1]=void 0!==e.y?e.y:e[1],r.data[n+2]=void 0!==e.z?e.z:e[2];break;case 4:r.data[n]=void 0!==e.x?e.x:e[0],r.data[n+1]=void 0!==e.y?e.y:e[1],r.data[n+2]=void 0!==e.z?e.z:e[2],r.data[n+3]=void 0!==e.w?e.w:e[3];break;default:void 0!==e.x?r.data[n]=e.x:void 0!==e[0]?r.data[n]=e[0]:r.data[n]=e}}),this},n.prototype.buffer=function(){return this.data},n.prototype.attributePointers=function(){return this.pointers},e.exports=n}()},{}],11:[function(t,e,r){!function(){"use strict";function r(t,e,r,i,n){var o=t.gl;e=void 0!==e?e:t.x,r=void 0!==r?r:t.y,i=void 0!==i?i:t.width,n=void 0!==n?n:t.height,o.viewport(e,r,i,n)}function i(t){t=t||{},this.gl=n.get(),this.resize(t.width||this.gl.canvas.width,t.height||this.gl.canvas.height),this.offset(t.x,t.y)}var n=t("./WebGLContext"),o=t("../util/Stack"),s=new o;i.prototype.resize=function(t,e){return void 0!==t&&void 0!==e&&(this.width=t,this.height=e,this.gl.canvas.height=e,this.gl.canvas.width=t),this},i.prototype.offset=function(t,e){return void 0!==t&&void 0!==e&&(this.x=t,this.y=e),this},i.prototype.push=function(t,e,i,n){return s.push({viewport:this,x:t,y:e,width:i,height:n}),r(this,t,e,i,n),this},i.prototype.pop=function(){var t;return s.pop(),t=s.top(),t?r(t.viewport,t.x,t.y,t.width,t.height):r(this),this},e.exports=i}()},{"../util/Stack":14,"./WebGLContext":12}],12:[function(t,e,r){!function(){"use strict";function t(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?t:"string"==typeof t?document.getElementById(t):null}function r(e){if(e){var r=t(e);if(r)return s[r.id]}else if(o)return o;return null}function i(t){var e,r,i=t.gl;for(r=0;r<a.length;r++)e=a[r],t.extensions[e]=i.getExtension(e)}function n(t,e){var r,n;try{n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),r={id:t.id,gl:n,extensions:{}},i(r),s[t.id]=r,o=r}catch(a){console.error(a.message)}return n||console.error("Unable to initialize WebGL. Your browser may not support it."),r}var o=null,s={},a=["OES_texture_float","OES_texture_half_float","WEBGL_lose_context","OES_standard_derivatives","OES_vertex_array_object","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_frag_depth","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_blend_minmax","EXT_shader_texture_lod"];e.exports={bind:function(t){var e=r(t);return e?(o=e,this):(console.error("No context exists for provided argument '"+t+"', command ignored."),this)},get:function(e,i){var o=r(e);if(o)return o.gl;var a=t(e);return a&&n(a,i)?s[a.id].gl:(console.error("Context could not be found or created for argument of type'"+typeof e+"', returning 'null'."),null)},supportedExtensions:function(t){var e=r(t);if(e){var i=e.extensions,n=[];for(var o in i)i.hasOwnProperty(o)&&i[o]&&n.push(o);return n}return console.error("No context is currently bound or was provided, returning an empty array."),[]},unsupportedExtensions:function(t){var e=r(t);if(e){var i=e.extensions,n=[];for(var o in i)i.hasOwnProperty(o)&&!i[o]&&n.push(o);return n}return console.error("No context is currently bound or was provided, returning an empty array."),[]},checkExtension:function(t,e){e||(e=t,t=null);var i=r(t);if(i){var n=i.extensions;return n[e]?n[e]:!1}return console.error("No context is currently bound or provided as argument, returning false."),!1}}}()},{}],13:[function(t,e,r){!function(){"use strict";e.exports={IndexBuffer:t("./core/IndexBuffer"),Renderable:t("./core/Renderable"),RenderTarget:t("./core/RenderTarget"),Shader:t("./core/Shader"),Texture2D:t("./core/Texture2D"),TextureCubeMap:t("./core/TextureCubeMap"),VertexBuffer:t("./core/VertexBuffer"),VertexPackage:t("./core/VertexPackage"),Viewport:t("./core/Viewport"),WebGLContext:t("./core/WebGLContext")}}()},{"./core/IndexBuffer":2,"./core/RenderTarget":3,"./core/Renderable":4,"./core/Shader":5,"./core/Texture2D":7,"./core/TextureCubeMap":8,"./core/VertexBuffer":9,"./core/VertexPackage":10,"./core/Viewport":11,"./core/WebGLContext":12}],14:[function(t,e,r){!function(){"use strict";function t(){this.data=[]}t.prototype.push=function(t){return this.data.push(t),this},t.prototype.pop=function(){return this.data.pop(),this},t.prototype.top=function(){var t=this.data.length-1;return 0>t?null:this.data[t]},e.exports=t}()},{}],15:[function(t,e,r){!function(){"use strict";function r(t){return function(e){t.resolve(e)}}function i(t,e){var i,n,o=[];for(n=0;n<t.length;n++)i=new s,o.push(i),t[n](r(i));a.apply(a,o).then(function(){var t=Array.prototype.slice.call(arguments,0);e(t)})}function n(t,e){var i,n,o=[],u=[];for(n in t)t.hasOwnProperty(n)&&(i=new s,u.push(i),o.push(n),t[n](r(i)));a.apply(a,u).done(function(){var t,r=Array.prototype.slice.call(arguments,0),i={};for(t=0;t<o.length;t++)i[o[t]]=r[t];e(i)})}var o=t("simply-deferred"),s=o.Deferred,a=o.when;e.exports={async:function(t,e){t instanceof Array?i(t,e):n(t,e)},isTypedArray:function(t){return t&&t.buffer instanceof ArrayBuffer&&void 0!==t.byteLength},isPowerOfTwo:function(t){return 0!==t?0===(t&t-1):!1},nextHighestPowerOfTwo:function(t){var e;for(0!==t&&(t-=1),e=1;32>e;e<<=1)t|=t>>e;return t+1}}}()},{"simply-deferred":1}],16:[function(t,e,r){!function(){"use strict";e.exports={load:function(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType=e.responseType,r.addEventListener("load",function(){e.success&&e.success(this.response)}),e.progress&&r.addEventListener("progress",function(t){e.progress(t)}),e.error&&r.addEventListener("error",function(t){e.error(t)}),r.send()}}}()},{}]},{},[13])(13)});
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.esper=t()}}(function(){var t;return function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return n(r?r:e)},c,c.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,r,i){(function(){var e,r,n,o,a,s,u,f,c,l,h,p,d,E,m=[].slice;a="3.0.0",r="pending",o="resolved",n="rejected",c=function(t,e){return null!=t?t.hasOwnProperty(e):void 0},h=function(t){return c(t,"length")&&c(t,"callee")},p=function(t){return c(t,"promise")&&"function"==typeof(null!=t?t.promise:void 0)},f=function(t){return h(t)?f(Array.prototype.slice.call(t)):Array.isArray(t)?t.reduce(function(t,e){return Array.isArray(e)?t.concat(f(e)):(t.push(e),t)},[]):[t]},s=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},d=function(t,e){return function(){var r;return r=[t].concat(Array.prototype.slice.call(arguments,0)),e.apply(this,r)}},u=function(t,e,r){var i,n,o,a,s;for(a=f(t),s=[],n=0,o=a.length;o>n;n++)i=a[n],s.push(i.call.apply(i,[r].concat(m.call(e))));return s},e=function(){var t,i,a,s,c,l,h;return h=r,s=[],c=[],l=[],a={resolved:{},rejected:{},pending:{}},this.promise=function(t){var i,d;return t=t||{},t.state=function(){return h},d=function(e,i,n){return function(){return h===r&&i.push.apply(i,f(arguments)),e()&&u(arguments,a[n]),t}},t.done=d(function(){return h===o},s,o),t.fail=d(function(){return h===n},c,n),t.progress=d(function(){return h!==r},l,r),t.always=function(){var e;return(e=t.done.apply(t,arguments)).fail.apply(e,arguments)},i=function(r,i,n){var o,a;return a=new e,o=function(e,r,i){return i?t[e](function(){var t,e;return t=1<=arguments.length?m.call(arguments,0):[],e=i.apply(null,t),p(e)?e.done(a.resolve).fail(a.reject).progress(a.notify):a[r](e)}):t[e](a[r])},o("done","resolve",r),o("fail","reject",i),o("progress","notify",n),a},t.pipe=i,t.then=i,null==t.promise&&(t.promise=function(){return t}),t},this.promise(this),t=this,i=function(e,i,n){return function(){return h===r?(h=e,a[e]=arguments,u(i,a[e],n),t):this}},this.resolve=i(o,s),this.reject=i(n,c),this.notify=i(r,l),this.resolveWith=function(t,e){return i(o,s,t).apply(null,e)},this.rejectWith=function(t,e){return i(n,c,t).apply(null,e)},this.notifyWith=function(t,e){return i(r,l,t).apply(null,e)},this},E=function(){var t,r,i,n,o,a,u;if(r=f(arguments),1===r.length)return p(r[0])?r[0]:(new e).resolve(r[0]).promise();if(o=new e,!r.length)return o.resolve().promise();for(n=[],i=s(r.length,function(){return o.resolve.apply(o,n)}),r.forEach(function(t,e){return p(t)?t.done(function(){var t;return t=1<=arguments.length?m.call(arguments,0):[],n[e]=t.length>1?t:t[0],i()}):(n[e]=t,i())}),a=0,u=r.length;u>a;a++)t=r[a],p(t)&&t.fail(o.reject);return o.promise()},l=function(t){return t.Deferred=function(){return new e},t.ajax=d(t.ajax,function(t,r){var i,n,o,a;return null==r&&(r={}),n=new e,i=function(t,e){return d(t,function(){var t,r;return r=arguments[0],t=2<=arguments.length?m.call(arguments,1):[],r&&r.apply(null,t),e.apply(null,t)})},r.success=i(r.success,n.resolve),r.error=i(r.error,n.reject),a=t(r),o=n.promise(),o.abort=function(){return a.abort()},o}),t.when=E},"undefined"!=typeof i?(i.Deferred=function(){return new e},i.when=E,i.installInto=l):"function"==typeof t&&t.amd?t(function(){return"undefined"!=typeof Zepto?l(Zepto):(e.when=E,e.installInto=l,e)}):"undefined"!=typeof Zepto?l(Zepto):(this.Deferred=function(){return new e},this.Deferred.when=E,this.Deferred.installInto=l)}).call(this)},{}],2:[function(t,e,r){!function(){"use strict";function r(t){return t.mipMap||"REPEAT"===t.wrapS||"MIRRORED_REPEAT"===t.wrapS||"REPEAT"===t.wrapT||"MIRRORED_REPEAT"===t.wrapT}function i(t,e){var i=document.createElement("canvas");r(t)?(i.width=u.nextHighestPowerOfTwo(e.width),i.height=u.nextHighestPowerOfTwo(e.height)):(i.width=e.width,i.height=e.height);var n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height);var o=n.getImageData(0,0,i.width,i.height).data;t.data=new Uint8Array(o),t.width=i.width,t.height=i.height}function n(t,e){if(t=t||{},t.wrapS=t.wrapS||t.wrap,t.wrapT=t.wrapT||t.wrap,t.minFilter=t.minFilter||t.filter,t.magFilter=t.magFilter||t.filter,t.wrapS=l[t.wrapS]?t.wrapS:m,t.wrapT=l[t.wrapT]?t.wrapT:m,t.minFilter=c[t.minFilter]?t.minFilter:T,t.magFilter=f[t.magFilter]?t.magFilter:T,t.mipMap=void 0!==t.mipMap?t.mipMap:g,t.invertY=void 0!==t.invertY?t.invertY:_,t.preMultiplyAlpha=void 0!==t.preMultiplyAlpha?t.preMultiplyAlpha:v,t.format=p[t.format]?t.format:E,t.image)t.type="UNSIGNED_BYTE",i(t,t.image),a.call(this,t);else if(t.url){t.type="UNSIGNED_BYTE";var r=this;s.load({url:t.url,success:function(n){i(t,n),a.call(r,t),e&&e(null,r)},error:function(i){a.call(r,t),e&&e(i,null)}})}else void 0===t.data&&(t.mipMap=!1),"FLOAT"===t.type&&(o.checkExtension("OES_texture_float")||(console.warn("Cannot create ColorTexture2D of type gl.FLOAT as `OES_texture_float` is unsupported by this browser, defaulting to",d),t.type=d)),t.type=h[t.type]?t.type:d,a.call(this,t)}var o=t("./WebGLContext"),a=t("./Texture2D"),s=t("../util/ImageLoader"),u=t("../util/Util"),f={NEAREST:!0,LINEAR:!0},c={NEAREST:!0,LINEAR:!0,NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},l={REPEAT:!0,MIRRORED_REPEAT:!0,CLAMP_TO_EDGE:!0},h={UNSIGNED_BYTE:!0,FLOAT:!0},p={RGB:!0,RGBA:!0},d="UNSIGNED_BYTE",E="RGBA",m="REPEAT",T="LINEAR",v=!0,g=!0,_=!0;n.prototype=Object.create(a.prototype),e.exports=n}()},{"../util/ImageLoader":17,"../util/Util":19,"./Texture2D":9,"./WebGLContext":14}],3:[function(t,e,r){!function(){"use strict";function r(t){return i.checkExtension("WEBGL_depth_texture")?(t=t||{},t.wrapS=t.wrapS||t.wrap,t.wrapT=t.wrapT||t.wrap,t.minFilter=t.minFilter||t.filter,t.magFilter=t.magFilter||t.filter,t.wrapS=s[t.wrapS]?t.wrapS:h,t.wrapT=s[t.wrapT]?t.wrapT:h,t.minFilter=a[t.minFilter]?t.minFilter:p,t.magFilter=o[t.magFilter]?t.magFilter:p,t.mipMap=!1,t.invertY=!1,t.preMultiplyAlpha=!1,t.format=f[t.format]?t.format:l,"DEPTH_STENCIL"===t.format?t.type="UNSIGNED_INT_24_8_WEBGL":t.type=u[t.type]?t.type:c,void n.call(this,t)):void console.error("Cannot create DepthTexture2D as `WEBGL_depth_texture` extension is unsupported by this browser, command ignored")}var i=t("./WebGLContext"),n=t("./Texture2D"),o={NEAREST:!0,LINEAR:!0},a={NEAREST:!0,LINEAR:!0},s={REPEAT:!0,CLAMP_TO_EDGE:!0,MIRRORED_REPEAT:!0},u={UNSIGNED_BYTE:!0,UNSIGNED_SHORT:!0,UNSIGNED_INT:!0},f={DEPTH_COMPONENT:!0,DEPTH_STENCIL:!0},c="UNSIGNED_INT",l="DEPTH_COMPONENT",h="CLAMP_TO_EDGE",p="LINEAR";r.prototype=Object.create(n.prototype),e.exports=r}()},{"./Texture2D":9,"./WebGLContext":14}],4:[function(t,e,r){!function(){"use strict";function r(t,e){e=e||{},this.gl=i.get(),this.buffer=0,this.type=n[e.type]?e.type:s,this.mode=o[e.mode]?e.mode:u,this.count=void 0!==e.count?e.count:c,this.offset=void 0!==e.offset?e.offset:f,t&&(t instanceof WebGLBuffer?this.buffer=t:this.bufferData(t))}var i=t("./WebGLContext"),n={UNSIGNED_SHORT:!0,UNSIGNED_INT:!0},o={POINTS:!0,LINES:!0,LINE_STRIP:!0,LINE_LOOP:!0,TRIANGLES:!0,TRIANGLE_STRIP:!0,TRIANGLE_FAN:!0},a=null,s="UNSIGNED_SHORT",u="TRIANGLES",f=0,c=0;r.prototype.bufferData=function(t){var e=this.gl,r=i.checkExtension("OES_element_index_uint");if(r?t instanceof Array&&(t=new Uint32Array(t)):t instanceof Array?t=new Uint16Array(t):t instanceof Uint32Array&&(console.warn("Cannot create IndexBuffer of format gl.UNSIGNED_INT as OES_element_index_uint is not supported, defaulting to gl.UNSIGNED_SHORT."),t=new Uint16Array(t)),t instanceof Uint16Array)this.type="UNSIGNED_SHORT";else{if(!(t instanceof Uint32Array))return console.error("IndexBuffer requires an Array or ArrayBuffer argument, command ignored."),this;this.type="UNSIGNED_INT"}return this.buffer||(this.buffer=e.createBuffer()),this.count===c&&(this.count=t.length),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this},r.prototype.bind=function(){if(a!==this){var t=this.gl;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),a=this,this}},r.prototype.unbind=function(){if(null!==a){var t=this.gl;return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),a=null,this}},r.prototype.draw=function(t){if(t=t||{},null===a)return console.warn("No IndexBuffer is bound, command ignored."),this;var e=this.gl,r=e[t.mode||this.mode],i=e[this.type],n=void 0!==t.offset?t.offset:this.offset,o=void 0!==t.count?t.count:this.count;return 0===o?(console.warn("Attempting to draw an IndexBuffer with a count of 0, command ignored."),this):n+o>this.count?(console.warn("Attempting to draw with (offset + count) greater than the size of the IndexBuffer, command ignored."),this):(e.drawElements(r,o,i,n),this)},e.exports=r}()},{"./WebGLContext":14}],5:[function(t,e,r){!function(){"use strict";function r(t){if(u!==t){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer),u=t}}function i(t){if(null!==u){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),u=null}}function n(){var t=this.gl=o.get();this.framebuffer=t.createFramebuffer(),this.textures={}}var o=t("./WebGLContext"),a=t("../util/Stack"),s=new a,u=null;n.prototype.push=function(){return s.push(this),r(this),this},n.prototype.pop=function(){if(this!==s.top())return console.warn("The current render target is not the top most element on the stack. Command ignored."),this;s.pop();var t=s.top();return t?r(t):i(this),this},n.prototype.setColorTarget=function(t,e,r){var i=this.gl;return"string"==typeof e&&(r=e,e=void 0),e=void 0!==e?e:0,this.textures["color"+e]=t,this.push(),i.framebufferTexture2D(i.FRAMEBUFFER,i["COLOR_ATTACHMENT"+e],i[r||"TEXTURE_2D"],t.texture,0),this.pop(),this},n.prototype.setDepthTarget=function(t){var e=this.gl;return this.textures.depth=t,this.push(),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,t.texture,0),this.pop(),this},n.prototype.resize=function(t,e){if(!t||!e)return console.warn("Width or height arguments missing, command ignored."),this;var r=this.textures;return Object.keys(r).forEach(function(i){r[i].resize(t,e)}),this},e.exports=n}()},{"../util/Stack":18,"./WebGLContext":14}],6:[function(t,e,r){!function(){"use strict";function r(t,e){if(t=t||{},e=e||{},t.vertexBuffer||t.vertexBuffers)this.vertexBuffers=t.vertexBuffers||[t.vertexBuffer];else{var r=new i(t.vertices);this.vertexBuffers=[new n(r)]}t.indexBuffer?this.indexBuffer=t.indexBuffer:t.indices&&(this.indexBuffer=new o(t.indices)),this.options={mode:e.mode,offset:e.offset,count:e.count}}var i=t("../core/VertexPackage"),n=t("../core/VertexBuffer"),o=t("../core/IndexBuffer");r.prototype.draw=function(t){var e=t||{};return e.mode=e.mode||this.options.mode,e.offset=void 0!==e.offset?e.offset:this.options.offset,e.count=void 0!==e.count?e.count:this.options.count,this.indexBuffer?(this.vertexBuffers.forEach(function(t){t.bind()}),this.indexBuffer.bind(),this.indexBuffer.draw(e)):this.vertexBuffers.forEach(function(t){t.bind(),t.draw(e)}),this},e.exports=r}()},{"../core/IndexBuffer":4,"../core/VertexBuffer":11,"../core/VertexPackage":12}],7:[function(t,e,r){!function(){"use strict";function r(t,e,r){var i=d.parseDeclarations([e,r],["uniform","attribute"]),n=0;i.forEach(function(e){"attribute"===e.qualifier?t.attributes[e.name]={type:e.type,index:n++}:"uniform"===e.qualifier&&(t.uniforms[e.name]={type:e.type,func:v[e.type+(e.count>1?"[]":"")]})})}function i(t,e,r){var i=t.createShader(t[r]);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.error("An error occurred compiling the shaders:",t.getShaderInfoLog(i)),null)}function n(t){var e=t.gl,r=t.attributes;Object.keys(r).forEach(function(i){e.bindAttribLocation(t.program,r[i].index,i)})}function o(t){var e=t.gl,r=t.uniforms;Object.keys(r).forEach(function(i){r[i].location=e.getUniformLocation(t.program,i)})}function a(t){return function(e){m.load({url:t,responseType:"text",success:function(t){console.log(),e(null,t)},error:function(t){e(t,null)}})}}function s(t){return function(e){e(null,t)}}function u(t){return function(e){var r=[];t=t||[],t=t instanceof Array?t:[t],t.forEach(function(t){d.isGLSL(t)?r.push(s(t)):r.push(a(t))}),E.parallel(r,e)}}function f(t){_!==t&&(t.gl.useProgram(t.program),_=t)}function c(t){null!==_&&(t.gl.useProgram(null),_=null)}function l(t){return t.program=null,t.attributes=null,t.uniforms=null,t}function h(t,e){var r=this;return t=t||{},this.program=0,this.gl=p.get(),this.version=t.version||"1.00",this.attributes={},this.uniforms={},this.hasLoggedError=!1,t.vert?t.frag?void E.parallel({common:u(t.common),vert:u(t.vert),frag:u(t.frag)},function(t,i){return t?void(e&&e(t,null)):(r.create(i),void(e&&e(null,r)))}):void console.error("Fragment shader argument has not been provided, shader initialization aborted."):void console.error("Vertex shader argument has not been provided, shader initialization aborted.")}var p=t("./WebGLContext"),d=t("./ShaderParser"),E=t("../util/Async"),m=t("../util/XHRLoader"),T=t("../util/Stack"),v={bool:"uniform1i","bool[]":"uniform1iv","float":"uniform1f","float[]":"uniform1fv","int":"uniform1i","int[]":"uniform1iv",uint:"uniform1i","uint[]":"uniform1iv",vec2:"uniform2fv","vec2[]":"uniform2fv",ivec2:"uniform2iv","ivec2[]":"uniform2iv",vec3:"uniform3fv","vec3[]":"uniform3fv",ivec3:"uniform3iv","ivec3[]":"uniform3iv",vec4:"uniform4fv","vec4[]":"uniform4fv",ivec4:"uniform4iv","ivec4[]":"uniform4iv",mat2:"uniformMatrix2fv","mat2[]":"uniformMatrix2fv",mat3:"uniformMatrix3fv","mat3[]":"uniformMatrix3fv",mat4:"uniformMatrix4fv","mat4[]":"uniformMatrix4fv",sampler2D:"uniform1i",samplerCube:"uniform1i"},g=new T,_=null;h.prototype.create=function(t){var e=this.gl,a=t.common.join(""),s=t.vert.join(""),u=t.frag.join(""),f=i(e,a+s,"VERTEX_SHADER"),c=i(e,a+u,"FRAGMENT_SHADER");return f&&c?(r(this,s,u),this.program=e.createProgram(),e.attachShader(this.program,f),e.attachShader(this.program,c),n(this),e.linkProgram(this.program),e.getProgramParameter(this.program,e.LINK_STATUS)?(o(this),this):(console.error("An error occured linking the shader:",e.getProgramInfoLog(this.program)),console.error("Aborting instantiation of shader due to linking errors."),l(this))):(console.error("Aborting instantiation of shader due to compilation errors."),l(this))},h.prototype.push=function(){return g.push(this),f(this),this},h.prototype.pop=function(){var t;return g.pop(),t=g.top(),t?f(t):c(this),this},h.prototype.setUniform=function(t,e){if(!this.program)return void(this.hasLoggedError||(console.warn("Attempting to use an incomplete shader, command ignored."),this.hasLoggedError=!0));if(this!==_)return console.warn("Attempting to set uniform `"+t+"` for an unbound shader, command ignored."),this;var r=this.uniforms[t];if(!r)return console.warn("No uniform found under name `"+t+"`, command ignored."),this;if(void 0===e)return console.warn("Argument passed for uniform `"+t+"` is undefined, command ignored."),this;switch(e.toArray&&(e=e.toArray()),e instanceof Array&&(e=new Float32Array(e)),"boolean"==typeof e&&(e=e?1:0),r.type){case"mat2":case"mat3":case"mat4":this.gl[r.func](r.location,!1,e);break;default:this.gl[r.func](r.location,e)}return this},e.exports=h}()},{"../util/Async":16,"../util/Stack":18,"../util/XHRLoader":20,"./ShaderParser":8,"./WebGLContext":14}],8:[function(t,e,r){!function(){"use strict";function t(t){return t.replace(f,"")}function r(t){return t.replace(c," ").replace(l," ").replace(h,"$2$4$6")}function i(t,e,r,i){var n=i.match(p),o=n[1],a=void 0===n[2]?1:parseInt(n[2],10);return{qualifier:t,precision:e,type:r,name:o,count:a}}function n(t,e){var r,n=t.split(",").map(function(t){return t.trim()}),o=n.shift().split(" "),a=o.shift(),f=o.shift();s[f]?r=o.shift():(r=f,f=e[u[r]]);var c=o.concat(n),l=[];return c.forEach(function(t){l.push(i(a,f,r,t))}),l}function o(e,i){var o=t(e),a=r(o),s=a.split(";"),u=i.join("|"),f=new RegExp(".*\\b("+u+")\\b.*"),c={},l=[];return s.forEach(function(t){var e=t.match(d);if(e)return void(c[e[3]]=e[2]);var r=t.match(f);r&&(l=l.concat(n(r[0],c)))}),l}function a(t){var e={};return t.filter(function(t){return e[t.name]?!1:(e[t.name]=!0,!0)})}var s={highp:!0,mediump:!0,lowp:!0},u={"float":"float",vec2:"float",vec3:"float",vec4:"float",ivec2:"int",ivec3:"int",ivec4:"int","int":"int",uint:"int",sampler2D:"sampler2D",samplerCube:"samplerCube"},f=/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,c=/(\r\n|\n|\r)/gm,l=/\s{2,}/g,h=/(\s*)(\[)(\s*)(\d+)(\s*)(\])(\s*)/g,p=/([a-zA-Z_][a-zA-Z0-9_]*)(?:\[(\d+)\])?/,d=/\b(precision)\s+(\w+)\s+(\w+)/,E=/void\s+main\s*\(\s*\)\s*/im;e.exports={parseDeclarations:function(t,e){if(!e||0===e.length||!t||0===t.length)return[];t=t instanceof Array?t:[t],e=e instanceof Array?e:[e];var r=[];return t.forEach(function(t){r=r.concat(o(t,e))}),a(r)},isGLSL:function(t){return E.test(t)}}}()},{}],9:[function(t,e,r){!function(){"use strict";function r(t,e){if(p!==t){var r=t.gl;e=r["TEXTURE"+e]||r.TEXTURE0,r.activeTexture(e),r.bindTexture(r.TEXTURE_2D,t.texture),p=t}}function i(t){if(null!==p){var e=t.gl;e.bindTexture(e.TEXTURE_2D,null),p=null}}function n(t){this.gl=o.get(),this.texture=this.gl.createTexture(),t.wrapS=t.wrapS||t.wrap,t.wrapT=t.wrapT||t.wrap,t.minFilter=t.minFilter||t.filter,t.magFilter=t.magFilter||t.filter,this.wrapS=t.wrapS||m,this.wrapT=t.wrapT||m,this.minFilter=t.minFilter||T,this.magFilter=t.magFilter||T,this.mipMap=void 0!==t.mipMap?t.mipMap:g,this.invertY=void 0!==t.invertY?t.invertY:_,this.preMultiplyAlpha=void 0!==t.preMultiplyAlpha?t.preMultiplyAlpha:v,this.format=t.format||E,this.type=t.type||d,this.bufferData(t.data||null,t.width,t.height),this.setParameters(this),t.callback&&t.callback(this)}var o=t("./WebGLContext"),a=t("../util/Stack"),s={NEAREST:!0,LINEAR:!0},u={NEAREST:!0,LINEAR:!0,NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},f={NEAREST:!0,LINEAR:!0},c={NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},l={REPEAT:!0,MIRRORED_REPEAT:!0,CLAMP_TO_EDGE:!0},h={},p=null,d="UNSIGNED_BYTE",E="RGBA",m="REPEAT",T="LINEAR",v=!0,g=!0,_=!0,A="_MIPMAP_LINEAR";n.prototype.push=function(t){return h[t]=h[t]||new a,h[t].push(this),r(this,t),this},n.prototype.pop=function(t){if(!h[t])return console.warn("No texture was bound to texture unit `"+t+"`, command ignored."),this;if(this!==h[t].top())return console.warn("The current texture is not the top most element on the stack. Command ignored."),this;h[t].pop();var e=h[t].top();return e?r(e,t):i(this),this},n.prototype.bufferData=function(t,e,r){var i=this.gl;return this.push(),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.invertY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.preMultiplyAlpha),this.data=t,this.width=e||this.width,this.height=r||this.height,i.texImage2D(i.TEXTURE_2D,0,i[this.format],this.width,this.height,0,i[this.format],i[this.type],this.data),this.mipMap&&i.generateMipmap(i.TEXTURE_2D),this.pop(),this},n.prototype.setParameters=function(t){var e=this.gl;this.push();var r=t.wrapS||t.wrap;return r&&(l[r]?(this.wrapS=r,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[this.wrapS])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_WRAP_S`, command ignored.")),r=t.wrapT||t.wrap,r&&(l[r]?(this.wrapT=r,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[this.wrapT])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_WRAP_T`, command ignored.")),r=t.magFilter||t.filter,r&&(s[r]?(this.magFilter=r,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[this.magFilter])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_MAG_FILTER`, command ignored.")),r=t.minFilter||t.filter,r&&(this.mipMap?(f[r]&&(r+=A),c[r]?(this.minFilter=r,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[this.minFilter])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_MIN_FILTER`, command ignored.")):u[r]?(this.minFilter=r,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[this.minFilter])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_MIN_FILTER`, command ignored.")),this.pop(),this},n.prototype.resize=function(t,e){return t&&e?(this.bufferData(this.data,t,e),this):(console.warn("Width or height arguments missing, command ignored."),this)},e.exports=n}()},{"../util/Stack":18,"./WebGLContext":14}],10:[function(t,e,r){!function(){"use strict";function r(t){if(!f.isPowerOfTwo(t.width)||!f.isPowerOfTwo(t.height)){var e=document.createElement("canvas");e.width=f.nextHighestPowerOfTwo(t.width),e.height=f.nextHighestPowerOfTwo(t.height);var r=e.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),e}return t}function i(t,e){if(A!==t){var r=t.gl;e=r["TEXTURE"+e]||r.TEXTURE0,r.activeTexture(e),r.bindTexture(r.TEXTURE_CUBE_MAP,t.texture),A=t}}function n(t){if(null!==A){var e=t.gl;e.bindTexture(e.TEXTURE_CUBE_MAP,null),A=null}}function o(t,e,r){return function(i){c.load({url:e,success:function(e){t.bufferFaceData(r,e),i(null)},error:function(t){i(t,null)}})}}function a(t,e){var r=this;if(this.gl=s.get(),this.texture=this.gl.createTexture(),t.wrapS=t.wrapS||t.wrap,t.wrapT=t.wrapT||t.wrap,t.minFilter=t.minFilter||t.filter,t.magFilter=t.magFilter||t.filter,this.wrapS=v[t.wrapS]?t.wrapS:y,this.wrapT=v[t.wrapT]?t.wrapT:y,this.minFilter=E[t.minFilter]?t.minFilter:w,this.magFilter=d[t.magFilter]?t.magFilter:w,this.mipMap=void 0!==t.mipMap?t.mipMap:I,this.invertY=void 0!==t.invertY?t.invertY:N,this.preMultiplyAlpha=void 0!==t.preMultiplyAlpha?t.preMultiplyAlpha:b,this.format=g[t.format]?t.format:R,this.type=x,t.images)Object.keys(t.images).forEach(function(e){r.bufferFaceData(e,t.images[e])}),this.setParameters(this);else if(t.urls){var i={};Object.keys(t.urls).forEach(function(e){i[e]=o(r,t.urls[e],e)}),u.parallel(i,function(t){return t?void(e&&e(t,null)):(r.setParameters(r),void(e&&e(null,r)))})}else h.forEach(function(e){var i=(t.data?t.data[e]:t.data)||null;r.bufferFaceData(e,i,t.width,t.height)}),this.setParameters(this)}var s=t("./WebGLContext"),u=t("../util/Async"),f=t("../util/Util"),c=t("../util/ImageLoader"),l=t("../util/Stack"),h=["-x","+x","-y","+y","-z","+z"],p={"+z":"TEXTURE_CUBE_MAP_POSITIVE_Z","-z":"TEXTURE_CUBE_MAP_NEGATIVE_Z","+x":"TEXTURE_CUBE_MAP_POSITIVE_X","-x":"TEXTURE_CUBE_MAP_NEGATIVE_X","+y":"TEXTURE_CUBE_MAP_POSITIVE_Y","-y":"TEXTURE_CUBE_MAP_NEGATIVE_Y"},d={NEAREST:!0,LINEAR:!0},E={NEAREST:!0,LINEAR:!0,NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},m={NEAREST:!0,LINEAR:!0},T={NEAREST_MIPMAP_NEAREST:!0,LINEAR_MIPMAP_NEAREST:!0,NEAREST_MIPMAP_LINEAR:!0,LINEAR_MIPMAP_LINEAR:!0},v={REPEAT:!0,MIRRORED_REPEAT:!0,CLAMP_TO_EDGE:!0},g={RGB:!0,RGBA:!0},_={},A=null,x="UNSIGNED_BYTE",R="RGBA",y="CLAMP_TO_EDGE",w="LINEAR",b=!0,I=!0,N=!0,L="_MIPMAP_LINEAR";a.prototype.push=function(t){return _[t]=_[t]||new l,_[t].push(this),i(this,t),this},a.prototype.pop=function(t){if(!_[t])return console.warn("No texture was bound to texture unit `"+t+"`, command ignored."),this;if(this!==_[t].top())return console.warn("The current texture cube map is not the top most element on the stack. Command ignored."),this;_[t].pop();var e=_[t].top();return e?i(e,t):n(this),this},a.prototype.bufferFaceData=function(t,e,i,n){var o=this.gl,a=o[p[t]];return a?(this.push(),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,this.invertY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.preMultiplyAlpha),e instanceof HTMLImageElement?(this.images=this.images||{},this.images[t]=r(e),o.texImage2D(a,0,o[this.format],o[this.format],o[this.type],this.images[t])):(this.data=this.data||{},this.data[t]=e,this.width=i||this.width,this.height=n||this.height,o.texImage2D(a,0,o[this.format],this.width,this.height,0,o[this.format],o[this.type],e)),this.bufferedFaces=this.bufferedFaces||{},this.bufferedFaces[t]=!0,this.mipMap&&this.bufferedFaces["-x"]&&this.bufferedFaces["+x"]&&this.bufferedFaces["-y"]&&this.bufferedFaces["+y"]&&this.bufferedFaces["-z"]&&this.bufferedFaces["+z"]&&o.generateMipmap(o.TEXTURE_CUBE_MAP),this.pop(),this):(console.warn("Invalid face enumeration `"+t+"` provided, command ignored."),this)},a.prototype.setParameters=function(t){var e=this.gl;this.push();var r=t.wrapS||t.wrap;return r&&(v[r]?(this.wrapS=r,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e[this.wrapS])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_WRAP_S`, command ignored.")),r=t.wrapT||t.wrap,r&&(v[r]?(this.wrapT=r,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e[this.wrapT])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_WRAP_T`, command ignored.")),r=t.magFilter||t.filter,r&&(d[r]?(this.magFilter=r,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e[this.magFilter])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_MAG_FILTER`, command ignored.")),r=t.minFilter||t.filter,r&&(this.mipMap?(m[r]&&(r+=L),T[r]?(this.minFilter=r,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e[this.minFilter])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_MIN_FILTER`, command ignored.")):E[r]?(this.minFilter=r,e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e[this.minFilter])):console.warn("Texture parameter `"+r+"` is not a valid value for `TEXTURE_MIN_FILTER`, command ignored.")),this.pop(),this},e.exports=a}()},{"../util/Async":16,"../util/ImageLoader":17,"../util/Stack":18,"../util/Util":19,"./WebGLContext":14}],11:[function(t,e,r){!function(){"use strict";function r(t){var e=4,r=0,i=0;return Object.keys(t).forEach(function(n){var o=t[n],a=o.offset;a>r&&(r=a,i=a+o.size*e)}),i}function i(t){if(!t||0===Object.keys(t).length)return console.warning("VertexBuffer requires attribute pointers to be specified upon instantiation, this buffer will not draw correctly."),{};var e={};return Object.keys(t).forEach(function(r){var i=parseInt(r,10);if(isNaN(i))return void console.warn("Attribute index `"+r+"` does not represent an integer, discarding attribute pointer.");var n=t[r],o=n.size,a=n.type,s=n.offset;l[o]||(console.warn("Attribute pointer `size` parameter is invalid, defaulting to 4."),o=4),c[a]||(console.warn("Attribute pointer `type` parameter is invalid, defaulting to `FLOAT`."),a="FLOAT"),e[i]={size:o,type:a,offset:void 0!==s?s:0}}),e}function n(t){var e=0;return Object.keys(t).forEach(function(r){e+=t[r].size}),e}function o(t,e,n){n=n||{},this.buffer=0,this.gl=a.get(),this.mode=f[n.mode]?n:h,this.count=void 0!==n.count?n.count:d,this.offset=void 0!==n.offset?n.offset:p,t instanceof s?(this.pointers=t.pointers,n=e||{}):this.pointers=i(e),t&&(t instanceof s?this.bufferData(t.buffer):t instanceof WebGLBuffer?this.buffer=t:this.bufferData(t)),this.stride=r(this.pointers)}var a=t("./WebGLContext"),s=t("./VertexPackage"),u=t("../util/Util"),f={POINTS:!0,LINES:!0,LINE_STRIP:!0,LINE_LOOP:!0,TRIANGLES:!0,TRIANGLE_STRIP:!0,TRIANGLE_FAN:!0},c={FLOAT:!0},l={1:!0,2:!0,3:!0,4:!0},h="TRIANGLES",p=0,d=0,E=null,m={};o.prototype.bufferData=function(t){var e=this.gl;if(t instanceof Array)t=new Float32Array(t);else if(!u.isTypedArray(t)&&"number"!=typeof t)return console.error("VertexBuffer requires an Array or ArrayBuffer, or a size argument, command ignored."),this;if(this.buffer||(this.buffer=e.createBuffer()),this.count===d){var r=n(this.pointers);"number"==typeof t?this.count=t/r:this.count=t.length/r}e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)},o.prototype.bufferSubData=function(t,e){var r=this.gl;if(!this.buffer)return console.error("VertexBuffer has not been initially buffered, command ignored."),this;if(t instanceof Array)t=new Float32Array(t);else if(!u.isTypedArray(t))return console.error("VertexBuffer requires an Array or ArrayBuffer argument, command ignored."),this;e=void 0!==e?e:p,r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.bufferSubData(r.ARRAY_BUFFER,e,t)},o.prototype.bind=function(){if(E!==this){var t=this.gl,e=this.pointers,r=this.stride,i=m;E=this,m={},t.bindBuffer(t.ARRAY_BUFFER,this.buffer),Object.keys(e).forEach(function(n){var o=e[n];t.vertexAttribPointer(n,o.size,t[o.type],!1,r,o.offset),t.enableVertexAttribArray(n),m[n]=!0,delete i[n]}),Object.keys(i).forEach(function(e){t.disableVertexAttribArray(e)})}},o.prototype.unbind=function(){if(null!==E){var t=this.gl;Object.keys(this.pointers).forEach(function(e){t.disableVertexAttribArray(e)}),t.bindBuffer(t.ARRAY_BUFFER,null),E=null,m={}}},o.prototype.draw=function(t){if(t=t||{},null===E)return console.warn("No VertexBuffer is bound, command ignored."),this;var e=this.gl,r=e[t.mode||this.mode],i=void 0!==t.offset?t.offset:this.offset,n=void 0!==t.count?t.count:this.count;e.drawArrays(r,i,n)},e.exports=o}()},{"../util/Util":19,"./VertexPackage":12,"./WebGLContext":14}],12:[function(t,e,r){!function(){"use strict";function t(t){var e=[];return Object.keys(t).forEach(function(r){var i=parseInt(r,10);if(isNaN(i))return void console.warn("Attribute index `"+r+"` does not represent an integer, discarding attribute.");var n=t[r];n&&n instanceof Array&&n.length>0?e.push({index:i,data:n}):console.warn("Error parsing attribute of index `"+r+"`, attribute discarded.")}),e.sort(function(t,e){return t.index-e.index}),e}function r(t){return void 0!==t.x?void 0!==t.y?void 0!==t.z?void 0!==t.w?4:3:2:1:t instanceof Array?t.length:1}function i(t,e){var i=Number.MAX_VALUE,n=0;t.pointers={},e.forEach(function(e){var o=r(e.data[0]);i=Math.min(i,e.data.length),t.pointers[e.index]={type:f,size:o,offset:n*c},n+=o}),t.stride=n*c,t.length=i}function n(t,e,r,i,n){var o,a,s;for(a=0;r>a;a++)o=e[a],s=i+n*a,void 0!==o.x?t[s]=o.x:void 0!==o[0]?t[s]=o[0]:t[s]=o}function o(t,e,r,i,n){var o,a,s;for(a=0;r>a;a++)o=e[a],s=i+n*a,t[s]=void 0!==o.x?o.x:o[0],t[s+1]=void 0!==o.y?o.y:o[1]}function a(t,e,r,i,n){var o,a,s;for(a=0;r>a;a++)o=e[a],s=i+n*a,t[s]=void 0!==o.x?o.x:o[0],t[s+1]=void 0!==o.y?o.y:o[1],t[s+2]=void 0!==o.z?o.z:o[2]}function s(t,e,r,i,n){var o,a,s;for(a=0;r>a;a++)o=e[a],s=i+n*a,t[s]=void 0!==o.x?o.x:o[0],t[s+1]=void 0!==o.y?o.y:o[1],t[s+2]=void 0!==o.z?o.z:o[2],t[s+3]=void 0!==o.w?o.w:o[3]}function u(t){void 0!==t?this.set(t):(this.buffer=new Float32Array(0),this.pointers={})}var f="FLOAT",c=4;u.prototype.set=function(e){e=t(e),i(this,e);var r=this.length,u=this.stride/c,f=this.pointers,l=this.buffer=new Float32Array(r*u);return e.forEach(function(t){var e=f[t.index],i=e.offset/c;switch(e.size){case 2:o(l,t.data,r,i,u);break;case 3:a(l,t.data,r,i,u);break;case 4:s(l,t.data,r,i,u);break;default:n(l,t.data,r,i,u)}}),this},e.exports=u}()},{}],13:[function(t,e,r){!function(){"use strict";function r(t,e,r,i,n){var o=t.gl;e=void 0!==e?e:t.x,r=void 0!==r?r:t.y,i=void 0!==i?i:t.width,n=void 0!==n?n:t.height,o.viewport(e,r,i,n)}function i(t){t=t||{},this.gl=n.get(),this.resize(t.width||this.gl.canvas.width,t.height||this.gl.canvas.height),this.offset(void 0!==t.x?t.x:0,void 0!==t.y?t.y:0)}var n=t("./WebGLContext"),o=t("../util/Stack"),a=new o;i.prototype.resize=function(t,e){return void 0!==t&&void 0!==e&&(this.width=t,this.height=e,this.gl.canvas.width=t+this.x,this.gl.canvas.height=e+this.y),this},i.prototype.offset=function(t,e){return void 0!==t&&void 0!==e&&(this.x=t,this.y=e,this.gl.canvas.width=this.width+t,this.gl.canvas.height=this.height+e),this},i.prototype.push=function(t,e,i,n){return a.push({viewport:this,x:t,y:e,width:i,height:n}),r(this,t,e,i,n),this},i.prototype.pop=function(){if(this!==a.top().viewport)return console.warn("The current viewport is not the top most element on the stack. Command ignored."),
this;a.pop();var t=a.top();return t?r(t.viewport,t.x,t.y,t.width,t.height):r(this),this},e.exports=i}()},{"../util/Stack":18,"./WebGLContext":14}],14:[function(t,e,r){!function(){"use strict";function t(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?t:"string"==typeof t?document.getElementById(t):null}function r(e){if(e){var r=t(e);if(r)return a[r.id]}else if(o)return o;return null}function i(t){var e,r,i=t.gl;for(r=0;r<s.length;r++)e=s[r],t.extensions[e]=i.getExtension(e)}function n(t,e){var r,n;try{n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),r={id:t.id,gl:n,extensions:{}},i(r),a[t.id]=r,o=r}catch(s){console.error(s.message)}return n||console.error("Unable to initialize WebGL. Your browser may not support it."),r}var o=null,a={},s=["OES_texture_float","OES_texture_half_float","WEBGL_lose_context","OES_standard_derivatives","OES_vertex_array_object","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_frag_depth","EXT_sRGB","WEBGL_compressed_texture_etc1"];e.exports={bind:function(t){var e=r(t);return e?(o=e,this):(console.error("No context exists for provided argument `"+t+"`, command ignored."),this)},get:function(e,i){var o=r(e);if(o)return o.gl;var s=t(e);return s&&n(s,i)?a[s.id].gl:(console.error("Context could not be found or created for argument of type`"+typeof e+"`, returning `null`."),null)},supportedExtensions:function(t){var e=r(t);if(e){var i=e.extensions,n=[];return Object.keys(i).forEach(function(t){i[t]&&n.push(t)}),n}return console.error("No context is currently bound or was provided, returning an empty array."),[]},unsupportedExtensions:function(t){var e=r(t);if(e){var i=e.extensions,n=[];return Object.keys(i).forEach(function(t){i[t]||n.push(t)}),n}return console.error("No context is currently bound or was provided, returning an empty array."),[]},checkExtension:function(t,e){e||(e=t,t=null);var i=r(t);if(i){var n=i.extensions;return n[e]?n[e]:!1}return console.error("No context is currently bound or provided as argument, returning false."),!1}}}()},{}],15:[function(t,e,r){!function(){"use strict";e.exports={IndexBuffer:t("./core/IndexBuffer"),Renderable:t("./core/Renderable"),RenderTarget:t("./core/RenderTarget"),Shader:t("./core/Shader"),Texture2D:t("./core/Texture2D"),ColorTexture2D:t("./core/ColorTexture2D"),DepthTexture2D:t("./core/DepthTexture2D"),TextureCubeMap:t("./core/TextureCubeMap"),VertexBuffer:t("./core/VertexBuffer"),VertexPackage:t("./core/VertexPackage"),Viewport:t("./core/Viewport"),WebGLContext:t("./core/WebGLContext")}}()},{"./core/ColorTexture2D":2,"./core/DepthTexture2D":3,"./core/IndexBuffer":4,"./core/RenderTarget":5,"./core/Renderable":6,"./core/Shader":7,"./core/Texture2D":9,"./core/TextureCubeMap":10,"./core/VertexBuffer":11,"./core/VertexPackage":12,"./core/Viewport":13,"./core/WebGLContext":14}],16:[function(t,e,r){!function(){"use strict";function r(t){return function(e,r){return e?void t.reject(e):void t.resolve(r)}}function i(t,e){var i=[];t.forEach(function(t){var e=new a;i.push(e),t(r(e))}),s.apply(s,i).fail(function(t){e(t)}).done(function(){var t=Array.prototype.slice.call(arguments,0);e(null,t)})}function n(t,e){var i=[],n=[];Object.keys(t).forEach(function(e){var o=new a;n.push(o),i.push(e),t[e](r(o))}),s.apply(s,n).fail(function(t){e(t)}).done(function(){var t=Array.prototype.slice.call(arguments,0),r={};i.forEach(function(e,i){r[e]=t[i]}),e(null,r)})}var o=t("simply-deferred"),a=o.Deferred,s=o.when;e.exports={parallel:function(t,e){t instanceof Array?i(t,e):n(t,e)}}}()},{"simply-deferred":1}],17:[function(t,e,r){!function(){"use strict";e.exports={load:function(t){var e=new Image;e.onload=function(){t.success&&t.success(e)},e.onerror=function(e){if(t.error){var r="Unable to load image from URL: `"+e.path[0].currentSrc+"`";t.error(r)}},e.src=t.url}}}()},{}],18:[function(t,e,r){!function(){"use strict";function t(){this.data=[]}t.prototype.push=function(t){return this.data.push(t),this},t.prototype.pop=function(){return this.data.pop(),this},t.prototype.top=function(){var t=this.data.length-1;return 0>t?null:this.data[t]},e.exports=t}()},{}],19:[function(t,e,r){!function(){"use strict";e.exports={isTypedArray:function(t){return t&&t.buffer instanceof ArrayBuffer&&void 0!==t.byteLength},isPowerOfTwo:function(t){return 0!==t?0===(t&t-1):!1},nextHighestPowerOfTwo:function(t){var e;for(0!==t&&(t-=1),e=1;32>e;e<<=1)t|=t>>e;return t+1}}}()},{}],20:[function(t,e,r){!function(){"use strict";e.exports={load:function(t){var e=new XMLHttpRequest;e.open("GET",t.url,!0),e.responseType=t.responseType,e.onreadystatechange=function(){4===e.readyState&&(200===e.status?t.success&&t.success(e.response):t.error&&t.error("GET "+e.responseURL+" "+e.status+" ("+e.statusText+")"))},e.send()}}}()},{}]},{},[15])(15)});
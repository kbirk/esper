<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IndexBuffer.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ColorTexture2D.html">ColorTexture2D</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#setParameters">setParameters</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DepthTexture2D.html">DepthTexture2D</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#setParameters">setParameters</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="IndexBuffer.html">IndexBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexBuffer.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexBuffer.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexBuffer.html#draw">draw</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Renderable.html">Renderable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Renderable.html#draw">draw</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RenderTarget.html">RenderTarget</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#setColorTarget">setColorTarget</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#setDepthTarget">setDepthTarget</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Shader.html">Shader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shader.html#setUniform">setUniform</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shader.html#setUniforms">setUniforms</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shader.html#use">use</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Texture2D.html">Texture2D</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#setParameters">setParameters</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TextureCubeMap.html">TextureCubeMap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TextureCubeMap.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TextureCubeMap.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TextureCubeMap.html#setParameters">setParameters</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TextureCubeMap.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VertexBuffer.html">VertexBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#draw">draw</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VertexPackage.html">VertexPackage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexPackage.html#set">set</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Viewport.html">Viewport</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Viewport.html#pop">pop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Viewport.html#push">push</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Viewport.html#resize">resize</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">IndexBuffer.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const WebGLContext = require('./WebGLContext');

const TYPES = {
	UNSIGNED_BYTE: true,
	UNSIGNED_SHORT: true,
	UNSIGNED_INT: true
};
const MODES = {
	POINTS: true,
	LINES: true,
	LINE_STRIP: true,
	LINE_LOOP: true,
	TRIANGLES: true,
	TRIANGLE_STRIP: true,
	TRIANGLE_FAN: true
};
const BYTES_PER_TYPE = {
	UNSIGNED_BYTE: 1,
	UNSIGNED_SHORT: 2,
	UNSIGNED_INT: 4
};

/**
 * The default component type.
 * @private
 * @constant {string}
 */
const DEFAULT_TYPE = 'UNSIGNED_SHORT';

/**
 * The default render mode (primitive type).
 * @private
 * @constant {string}
 */
const DEFAULT_MODE = 'TRIANGLES';

/**
 * The default byte offset to render from.
 * @private
 * @constant {number}
 */
const DEFAULT_BYTE_OFFSET = 0;

/**
 * The default count of indices to render.
 * @private
 * @constant {number}
 */
const DEFAULT_COUNT = 0;

/**
 * An index buffer class to hole indexing information.
 */
class IndexBuffer {

	/**
	 * Instantiates an IndexBuffer object.
	 *
	 * @param {WebGLBuffer|Uint8Array|Uint16Array|Uin32Array|Array|Number} arg - The index data to buffer.
	 * @param {Object} options - The rendering options.
	 * @param {string} options.mode - The draw mode / primitive type.
	 * @param {string} options.byteOffset - The byte offset into the drawn buffer.
	 * @param {string} options.count - The number of vertices to draw.
	 */
	constructor(arg, options = {}) {
		this.gl = WebGLContext.get();
		this.buffer = null;
		this.type = TYPES[options.type] ? options.type : DEFAULT_TYPE;
		this.mode = MODES[options.mode] ? options.mode : DEFAULT_MODE;
		this.count = (options.count !== undefined) ? options.count : DEFAULT_COUNT;
		this.byteOffset = (options.byteOffset !== undefined) ? options.byteOffset : DEFAULT_BYTE_OFFSET;
		if (arg) {
			if (arg instanceof WebGLBuffer) {
				// WebGLBuffer argument
				this.buffer = arg;
			} else if (Number.isInteger(arg)) {
				// byte length argument
				if (options.type === undefined) {
					throw 'Argument of type `number` must be complimented with a corresponding `options.type`';
				}
				this.bufferData(arg);
			} else if (arg instanceof ArrayBuffer) {
				// ArrayBuffer arg
				if (options.type === undefined) {
					throw 'Argument of type `ArrayBuffer` must be complimented with a corresponding `options.type`';
				}
				this.bufferData(arg);
			} else {
				// Array or ArrayBufferView argument
				this.bufferData(arg);
			}
		} else {
			if (options.type === undefined) {
				throw 'Empty buffer must be complimented with a corresponding `options.type`';
			}
		}
	}

	/**
	 * Upload index data to the GPU.
	 *
	 * @param {Array|ArrayBuffer|ArrayBufferView|number} arg - The array of data to buffer.
	 *
	 * @returns {IndexBuffer} The index buffer object, for chaining.
	 */
	bufferData(arg) {
		const gl = this.gl;
		// cast array to ArrayBufferView based on provided type
		if (Array.isArray(arg)) {
			// check for type
			if (this.type === 'UNSIGNED_INT') {
				// buffer to uint32
				arg = new Uint32Array(arg);
			} else if (this.type === 'UNSIGNED_SHORT') {
				// buffer to uint16
				arg = new Uint16Array(arg);
			} else {
				// buffer to uint8
				arg = new Uint8Array(arg);
			}
		} else {
			// set ensure type corresponds to data
			if (arg instanceof Uint32Array) {
				this.type = 'UNSIGNED_INT';
			} else if (arg instanceof Uint16Array) {
				this.type = 'UNSIGNED_SHORT';
			} else if (arg instanceof Uint8Array) {
				this.type = 'UNSIGNED_BYTE';
			} else if (
				!(arg instanceof ArrayBuffer) &amp;&amp;
				!(Number.isInteger(arg))
				) {
				throw 'Argument must be of type `Array`, `ArrayBuffer`, `ArrayBufferView`, or `number`';
			}
		}
		// check that the type is supported by extension
		if (this.type === 'UNSIGNED_INT' &amp;&amp;
			!WebGLContext.checkExtension('OES_element_index_uint')) {
			throw 'Cannot create IndexBuffer of type `UNSIGNED_INT` as extension `OES_element_index_uint` is not supported';
		}
		// don't overwrite the count if it is already set
		if (this.count === DEFAULT_COUNT) {
			if (Number.isInteger(arg)) {
				this.count = (arg / BYTES_PER_TYPE[this.type]);
			} else {
				this.count = arg.length;
			}
		}
		// create buffer if it doesn't exist already
		if (!this.buffer) {
			this.buffer = gl.createBuffer();
		}
		// buffer the data
		gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);
		gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, arg, gl.STATIC_DRAW);
		return this;
	}

	/**
	 * Upload partial index data to the GPU.
	 *
	 * @param {Array|ArrayBuffer|ArrayBufferView} array - The array of data to buffer.
	 * @param {number} byteOffset - The byte offset at which to buffer.
	 *
	 * @returns {IndexBuffer} The index buffer object, for chaining.
	 */
	bufferSubData(array, byteOffset = DEFAULT_BYTE_OFFSET) {
		const gl = this.gl;
		if (!this.buffer) {
			throw 'Buffer has not yet been allocated, allocate with `bufferData`';
		}
		// cast array to ArrayBufferView based on provided type
		if (Array.isArray(array)) {
			// check for type
			if (this.type === 'UNSIGNED_INT') {
				// buffer to uint32
				array = new Uint32Array(array);
			} else if (this.type === 'UNSIGNED_SHORT') {
				// buffer to uint16
				array = new Uint16Array(array);
			} else {
				// buffer to uint8
				array = new Uint8Array(array);
			}
		} else if (
			!(array instanceof Uint8Array) &amp;&amp;
			!(array instanceof Uint16Array) &amp;&amp;
			!(array instanceof Uint32Array) &amp;&amp;
			!(array instanceof ArrayBuffer)) {
			throw 'Argument must be of type `Array`, `ArrayBuffer`, or `ArrayBufferView`';
		}
		gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);
		gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, byteOffset, array);
		return this;
	}

	/**
	 * Execute the draw command for the bound buffer.
	 *
	 * @param {Object} options - The options to pass to 'drawElements'. Optional.
	 * @param {string} options.mode - The draw mode / primitive type.
	 * @param {string} options.byteOffset - The byteOffset into the drawn buffer.
	 * @param {string} options.count - The number of vertices to draw.
	 *
	 * @returns {IndexBuffer} The index buffer object, for chaining.
	 */
	draw(options = {}) {
		const gl = this.gl;
		const mode = gl[options.mode || this.mode];
		const type = gl[this.type];
		const byteOffset = (options.byteOffset !== undefined) ? options.byteOffset : this.byteOffset;
		const count = (options.count !== undefined) ? options.count : this.count;
		if (count === 0) {
			throw 'Attempting to draw with a count of 0';
		}
		// bind buffer
		gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);
		// draw elements
		gl.drawElements(mode, count, type, byteOffset);
		// no need to unbind
		return this;
	}
}

module.exports = IndexBuffer;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Jun 14 2017 23:11:23 GMT-0400 (EDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

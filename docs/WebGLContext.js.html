<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebGLContext.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ColorTexture2D.html">ColorTexture2D</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#setParameters">setParameters</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ColorTexture2D.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DepthTexture2D.html">DepthTexture2D</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#setParameters">setParameters</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DepthTexture2D.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="IndexBuffer.html">IndexBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexBuffer.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexBuffer.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexBuffer.html#draw">draw</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Renderable.html">Renderable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Renderable.html#draw">draw</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RenderTarget.html">RenderTarget</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#setColorTarget">setColorTarget</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#setDepthTarget">setDepthTarget</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="RenderTarget.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Shader.html">Shader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shader.html#setUniform">setUniform</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shader.html#setUniforms">setUniforms</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Shader.html#use">use</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Texture2D.html">Texture2D</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#setParameters">setParameters</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture2D.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TextureCubeMap.html">TextureCubeMap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TextureCubeMap.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TextureCubeMap.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TextureCubeMap.html#setParameters">setParameters</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TextureCubeMap.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VertexBuffer.html">VertexBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#bufferData">bufferData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#bufferSubData">bufferSubData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#draw">draw</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexBuffer.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VertexPackage.html">VertexPackage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VertexPackage.html#set">set</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Viewport.html">Viewport</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Viewport.html#pop">pop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Viewport.html#push">push</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Viewport.html#resize">resize</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">WebGLContext.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const EXTENSIONS = [
	// ratified
	'OES_texture_float',
	'OES_texture_half_float',
	'WEBGL_lose_context',
	'OES_standard_derivatives',
	'OES_vertex_array_object',
	'WEBGL_debug_renderer_info',
	'WEBGL_debug_shaders',
	'WEBGL_compressed_texture_s3tc',
	'WEBGL_depth_texture',
	'OES_element_index_uint',
	'EXT_texture_filter_anisotropic',
	'EXT_frag_depth',
	'WEBGL_draw_buffers',
	'ANGLE_instanced_arrays',
	'OES_texture_float_linear',
	'OES_texture_half_float_linear',
	'EXT_blend_minmax',
	'EXT_shader_texture_lod',
	// community
	'WEBGL_compressed_texture_atc',
	'WEBGL_compressed_texture_pvrtc',
	'EXT_color_buffer_half_float',
	'WEBGL_color_buffer_float',
	'EXT_sRGB',
	'WEBGL_compressed_texture_etc1',
	'EXT_disjoint_timer_query',
	'EXT_color_buffer_float'
];

/**
 * All context wrappers.
 * @private
 */
const _contexts = new Map();

/**
 * The currently bound context.
 * @private
 */
let _boundContext = null;

/**
 * Returns an rfc4122 version 4 compliant UUID.
 *
 * @private
 *
 * @returns {string} - The UUID string.
 */
function getUUID() {
	const replace = function(c) {
		const r = Math.random() * 16 | 0;
		const v = (c === 'x') ? r : (r &amp; 0x3 | 0x8);
		return v.toString(16);
	};
	return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, replace);
}

/**
 * Returns the id of the HTMLCanvasElement element. If there is no id, it
 * generates one and appends it.
 *
 * @private
 *
 * @param {HTMLCanvasElement} canvas - The Canvas object.
 *
 * @returns {string} The Canvas id string.
 */
function getId(canvas) {
	if (!canvas.id) {
		canvas.id = getUUID();
	}
	return canvas.id;
}

/**
 * Returns a Canvas element object from either an existing object, or
 * identification string.
 *
 * @private
 *
 * @param {HTMLCanvasElement|String} arg - The Canvas object or Canvas id or selector string.
 *
 * @returns {HTMLCanvasElement} The Canvas element object.
 */
function getCanvas(arg) {
	if (arg instanceof HTMLCanvasElement) {
		return arg;
	} else if (typeof arg === 'string') {
		return document.getElementById(arg) ||
			document.querySelector(arg);
	}
	return null;
}

/**
 * Returns a wrapped WebGLRenderingContext from the context itself.
 *
 * @private
 *
 * @param {WebGLRenderingContext} context - The WebGLRenderingContext.
 *
 * @returns {Object} The context wrapper.
 */
function getWrapperFromContext(context) {
	let found = null;
	_contexts.forEach(wrapper => {
		if (context === wrapper.gl) {
			found = wrapper;
		}
	});
	return found;
}

/**
 * Attempts to retrieve a wrapped WebGLRenderingContext.
 *
 * @private
 *
 * @param {HTMLCanvasElement} arg - The Canvas element object to create the context under.
 *
 * @returns {Object} The context wrapper.
 */
function getContextWrapper(arg) {
	if (arg === undefined) {
		if (_boundContext) {
			// return last bound context
			return _boundContext;
		}
	} else if (arg instanceof WebGLRenderingContext) {
		return getWrapperFromContext(arg);
	} else {
		const canvas = getCanvas(arg);
		if (canvas) {
			return _contexts.get(getId(canvas));
		}
	}
	// no bound context or argument
	return null;
}

/**
 * Attempts to load all known extensions for a provided WebGLRenderingContext.
 * Stores the results in the context wrapper for later queries.
 *
 * @private
 *
 * @param {Object} contextWrapper - The context wrapper.
 */
function loadExtensions(contextWrapper) {
	const gl = contextWrapper.gl;
	EXTENSIONS.forEach(id => {
		contextWrapper.extensions.set(id, gl.getExtension(id));
	});
}

/**
 * Attempts to create a WebGLRenderingContext and load all extensions.
 *
 * @private
 *
 * @param {HTMLCanvasElement} canvas - The Canvas element object to create the context under.
 * @param {Object} options - Parameters to the webgl context, only used during instantiation. Optional.
 *
 * @returns {Object} The context wrapper.
 */
function createContextWrapper(canvas, options) {
	const gl = canvas.getContext('webgl', options) || canvas.getContext('experimental-webgl', options);
	if (!gl) {
		throw 'Unable to create a WebGLRenderingContext, please ensure your browser supports WebGL';
	}
	// wrap context
	const contextWrapper = {
		id: getId(canvas),
		gl: gl,
		extensions: new Map()
	};
	// load WebGL extensions
	loadExtensions(contextWrapper);
	// add context wrapper to map
	_contexts.set(getId(canvas), contextWrapper);
	// bind the context
	_boundContext = contextWrapper;
	return contextWrapper;
}

module.exports = {

	/**
	 * Retrieves an existing WebGL context associated with the provided argument
	 * and binds it. While bound, the active context will be used implicitly by
	 * any instantiated `esper` constructs.
	 *
	 * @param {HTMLCanvasElement|String} arg - The Canvas object or Canvas identification string.
	 *
	 * @returns {WebGLContext} The namespace, used for chaining.
	 */
	bind: function(arg) {
		const wrapper = getContextWrapper(arg);
		if (wrapper) {
			_boundContext = wrapper;
			return this;
		}
		throw `No context exists for provided argument '${arg}'`;
	},

	/**
	 * Retrieves an existing WebGL context associated with the provided
	 * argument. If no context exists, one is created. During creation attempts
	 * to load all extensions found at:
	 *     https://www.khronos.org/registry/webgl/extensions/.
	 *
	 * @param {HTMLCanvasElement|String} arg - The Canvas object or Canvas identification string. Optional.
	 * @param {Object} options - Parameters to the webgl context, only used during instantiation. Optional.
	 *
	 * @returns {WebGLRenderingContext} The WebGLRenderingContext object.
	 */
	get: function(arg, options) {
		const wrapper = getContextWrapper(arg);
		if (wrapper) {
			// return the native WebGLRenderingContext
			return wrapper.gl;
		}
		// get canvas element
		const canvas = getCanvas(arg);
		// try to find or create context
		if (!canvas) {
			throw `No context is currently bound or could be associated with provided argument of type ${typeof arg}`;
		}
		// create context
		return createContextWrapper(canvas, options).gl;
	},

	/**
	 * Removes an existing WebGL context object for the provided or currently
	 * bound context object.
	 *
	 * @param {WebGLRenderingContext|HTMLCanvasElement|String} arg - The Canvas object or Canvas identification string. Optional.
	 *
	 * @returns {WebGLRenderingContext} The WebGLRenderingContext object.
	 */
	remove: function(arg) {
		const wrapper = getContextWrapper(arg);
		if (wrapper) {
			// delete the context
			_contexts.delete(wrapper.id);
			// remove if currently bound
			if (wrapper === _boundContext) {
				_boundContext = null;
			}
		} else {
			throw `No context is currently bound or could be associated with provided argument of type ${typeof arg}`;
		}
	},

	/**
	 * Returns an array of all supported extensions for the provided or
	 * currently bound context object.
	 *
	 * @param {WebGLRenderingContext|HTMLCanvasElement|String} arg - The Canvas object or Canvas identification string. Optional.
	 *
	 * @returns {Array} All supported extensions.
	 */
	supportedExtensions: function(arg) {
		const wrapper = getContextWrapper(arg);
		if (wrapper) {
			const extensions = wrapper.extensions;
			const supported = [];
			extensions.forEach((extension, key) => {
				if (extension) {
					supported.push(key);
				}
			});
			return supported;
		}
		throw `No context is currently bound or could be associated with provided argument of type ${typeof arg}`;
	},

	/**
	 * Returns an array of all unsupported extensions for the provided or
	 * currently bound context object.
	 *
	 * @param {WebGLRenderingContext|HTMLCanvasElement|String} arg - The Canvas object or Canvas identification string. Optional.
	 *
	 * @returns {Array} All unsupported extensions.
	 */
	unsupportedExtensions: function(arg) {
		const wrapper = getContextWrapper(arg);
		if (wrapper) {
			const extensions = wrapper.extensions;
			const unsupported = [];
			extensions.forEach((extension, key) => {
				if (!extension) {
					unsupported.push(key);
				}
			});
			return unsupported;
		}
		throw `No context is currently bound or could be associated with provided argument of type ${typeof arg}`;
	},

	/**
	 * Checks if an extension has been successfully loaded for the provided or
	 * currently bound context object.
	 *
	 * @param {WebGLRenderingContext|HTMLCanvasElement|String} arg - The Canvas object or Canvas identification string. Optional.
	 * @param {string} extension - The extension name.
	 *
	 * @returns {boolean} Whether or not the provided extension has been loaded successfully.
	 */
	checkExtension: function(arg, extension) {
		if (!extension) {
			// shift parameters if no canvas arg is provided
			extension = arg;
			arg = undefined;
		}
		const wrapper = getContextWrapper(arg);
		if (wrapper) {
			const extensions = wrapper.extensions;
			return extensions.get(extension) ? true : false;
		}
		throw `No context is currently bound or could be associated with provided argument of type ${typeof arg}`;
	},

	/**
	 * Returns an extension if it has been successfully loaded for the provided
	 * or currently bound context object.
	 *
	 * @param {WebGLRenderingContext|HTMLCanvasElement|String} arg - The Canvas object or Canvas identification string. Optional.
	 * @param {string} extension - The extension name.
	 *
	 * @returns {boolean} Whether or not the provided extension has been loaded successfully.
	 */
	getExtension: function(arg, extension) {
		if (!extension) {
			// shift parameters if no canvas arg is provided
			extension = arg;
			arg = undefined;
		}
		const wrapper = getContextWrapper(arg);
		if (wrapper) {
			const extensions = wrapper.extensions;
			return extensions.get(extension) || null;
		}
		throw `No context is currently bound or could be associated with provided argument of type ${typeof arg}`;
	}
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Jun 14 2017 23:11:23 GMT-0400 (EDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
